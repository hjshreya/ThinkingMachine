<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>思考 — Socratic Thinking Tool</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>思</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #faf8f5;
            --bg-secondary: #f0ede7;
            --text-primary: #2a2520;
            --text-secondary: #6b635a;
            --accent: #c4704f;
            --accent-light: #e89c7f;
            --border: #d4cfc7;
            --shadow: rgba(42, 37, 32, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Pro', serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 4rem 2rem;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border);
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 3rem;
            font-weight: 300;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .intro {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent);
            animation: slideIn 1s ease-out 0.3s backwards;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .intro p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .chat-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            max-height: 500px;
            overflow-y: auto;
            animation: scaleIn 0.8s ease-out 0.5s backwards;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .message {
            margin-bottom: 1.5rem;
            animation: messageAppear 0.5s ease-out backwards;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .user-message {
            background: var(--bg-secondary);
            padding: 1rem 1.25rem;
            border-radius: 8px;
            border-left: 3px solid var(--accent-light);
        }

        .ai-message {
            background: linear-gradient(135deg, #f9f7f4 0%, #f3f0eb 100%);
            padding: 1rem 1.25rem;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
        }

        .ai-message p {
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .input-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
            padding: 1.5rem;
            animation: slideUp 0.8s ease-out 0.7s backwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        textarea {
            width: 100%;
            font-family: 'Crimson Pro', serif;
            font-size: 1.125rem;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            resize: vertical;
            min-height: 120px;
            color: var(--text-primary);
            background: var(--bg-primary);
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(196, 112, 79, 0.1);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        button {
            flex: 1;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.875rem;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .primary-btn {
            background: var(--accent);
            color: white;
        }

        .primary-btn:hover:not(:disabled) {
            background: #b05d3f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(196, 112, 79, 0.3);
        }

        .secondary-btn {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .secondary-btn:hover {
            background: var(--border);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .thinking-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.875rem;
        }

        .thinking-indicator.active {
            display: flex;
        }

        .dot {
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 1.125rem;
            font-style: italic;
        }

        /* Scrollbar styling */
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--accent-light);
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        @media (max-width: 640px) {
            .container {
                padding: 2rem 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>思考</h1>
            <p class="subtitle">Socratic Thinking Tool</p>
        </header>

        <div class="intro">
            <p>"I cannot teach anybody anything. I can only make them think." — Socrates</p>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="empty-state">
                <p>Share your question or challenge, and I'll guide you to discover your own insights.</p>
            </div>
        </div>

        <div class="input-container">
            <textarea 
                id="userInput" 
                placeholder="What would you like to think through today?"
                aria-label="Your question or thought"
            ></textarea>
            <div class="button-group">
                <button class="primary-btn" id="sendBtn" onclick="sendMessage()">
                    Guide My Thinking
                </button>
                <button class="secondary-btn" onclick="clearChat()">
                    Start Fresh
                </button>
            </div>
            <div class="thinking-indicator" id="thinkingIndicator">
                <span>Reflecting</span>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <script>
        let conversationHistory = [];

        const systemPrompt = `You are a Socratic thinking guide. Your purpose is NOT to provide direct answers, but to help users discover insights through their own reasoning.

Core principles:
1. NEVER give direct answers or solutions
2. Ask thoughtful, probing questions that guide thinking
3. Help users examine their assumptions
4. Encourage them to break down complex problems
5. Reflect back what they've said to deepen their understanding
6. Guide them to explore different perspectives
7. Help them recognize patterns in their own thinking

Techniques to use:
- Ask "What makes you think that?" or "How did you arrive at that conclusion?"
- Encourage them to define terms: "What do you mean by [concept]?"
- Explore implications: "If that were true, what would follow?"
- Challenge assumptions gently: "What are you assuming here?"
- Invite deeper analysis: "Can you break that down further?"
- Seek examples: "Can you give me a concrete example?"
- Compare and contrast: "How is this different from...?"

Keep responses concise (2-4 sentences max) with 1-2 focused questions. Be warm and encouraging, not interrogative. Help them feel guided, not tested.

Remember: Your goal is to illuminate their path, not to walk it for them.`;

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const userMessage = input.value.trim();
            
            if (!userMessage) return;

            // Add user message to chat
            addMessage('You', userMessage, 'user');
            conversationHistory.push({ role: 'user', content: userMessage });
            
            // Clear input
            input.value = '';
            
            // Show thinking indicator
            const indicator = document.getElementById('thinkingIndicator');
            const sendBtn = document.getElementById('sendBtn');
            indicator.classList.add('active');
            sendBtn.disabled = true;

            try {
                // Call our serverless function instead of Anthropic directly
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        system: systemPrompt,
                        messages: conversationHistory
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    addMessage('Guide', `I'm having trouble connecting. Error: ${data.error}`, 'ai');
                } else if (data.content && data.content[0]) {
                    const aiResponse = data.content[0].text;
                    conversationHistory.push({ role: 'assistant', content: aiResponse });
                    addMessage('Guide', aiResponse, 'ai');
                } else {
                    addMessage('Guide', 'I\'m having trouble reflecting right now. Could you rephrase your thought?', 'ai');
                }
            } catch (error) {
                console.error('Error:', error);
                addMessage('Guide', 'Something went wrong. Let\'s try again—what were you thinking about?', 'ai');
            } finally {
                indicator.classList.remove('active');
                sendBtn.disabled = false;
                input.focus();
            }
        }

        function addMessage(sender, content, type) {
            const chatContainer = document.getElementById('chatContainer');
            
            // Remove empty state if it exists
            const emptyState = chatContainer.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.animationDelay = '0s';
            
            const labelDiv = document.createElement('div');
            labelDiv.className = 'message-label';
            labelDiv.textContent = sender;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = type === 'user' ? 'user-message' : 'ai-message';
            
            const textElement = document.createElement('p');
            textElement.textContent = content;
            contentDiv.appendChild(textElement);
            
            messageDiv.appendChild(labelDiv);
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function clearChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = `
                <div class="empty-state">
                    <p>Share your question or challenge, and I'll guide you to discover your own insights.</p>
                </div>
            `;
            conversationHistory = [];
            document.getElementById('userInput').value = '';
            document.getElementById('userInput').focus();
        }

        // Allow Enter to send (Shift+Enter for new line)
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Focus input on load
        window.addEventListener('load', function() {
            document.getElementById('userInput').focus();
        });
    </script>
</body>
</html>
